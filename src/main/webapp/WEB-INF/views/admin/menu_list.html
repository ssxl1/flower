<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>节点管理</title>
    <link rel="stylesheet" href="/static/frame/layui/css/layui.css">
    <link rel="stylesheet" href="/static/frame/static/css/style.css">
    <link rel="icon" href="/static/frame/static/image/code.png">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
  <script src="/static/js/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript" src="/static/frame/layui/layui.js"></script>
<script type="text/javascript" src="/static/js/index.js"></script>
<body class="body">

<div th:include="views/admin/adminheads :: copy"></div> 

<hr class="layui-bg-gray">
<hr class="layui-bg-gray">

<!-- 工具集 -->
<div class="my-btn-box">
    <span class="fl">
   <a class="layui-btn btn-add btn-default" id="btn-add">添加</a>
   <!-- <a class="layui-btn btn-add btn-default" id="btn-pic">图表分析</a> -->
        <a class="layui-btn btn-add btn-default" id="btn-refresh"><i class="layui-icon">&#x1002;</i></a>
    </span><nbsp/><nbsp/>
    
   <div class="demoTable" style="padding-left:90px;">
    	id
    <div class="layui-inline">
        <input class="layui-input" name="apply_id" id="apply_id" autocomplete="off" placeholder="请输入appid" >
    </div>
    name
    <div class="layui-inline">
        <input class="layui-input" name="pname" id="pname" autocomplete="off" placeholder="请输入appname">
    </div>
    <button class="layui-btn" data-type="reload">搜索</button>
</div>
</div>

<!-- 表格 -->
<div id="dateTable"  lay-filter="test"></div>

 <!-- 需要弹出的添加子菜单界面 -->
        <div class="layui-row" id="test" style="display: none;">
            <div class="layui-col-md10">
            <form class="layui-form" id="add-form" >
                    <div class="layui-form-item">
                        <label class="layui-form-label">子菜单名称：</label>
                        <div class="layui-input-block">
                            <input type="text" name="ctext" id="ctext"  class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">子菜单status：</label>
                        <div class="layui-input-block">
                            <input type="radio" name="cstatus" id="cstatus" value="y" title="有效" checked>
                            <input type="radio" name="cstatus" id="cstatus" value="n" title="无效">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">描述：</label>
                        <div class="layui-input-block">
                            <input type="text" name="cdescription"  id="cdescription" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">href：</label>
                        <div class="layui-input-block">
                            <input type="text" name="href"  id="href"  class="layui-input">
                        </div>
                    </div>
                    <input type="hidden" name="menuid" id="menuid" >
                    
               	 <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button type="button"  lay-submit lay-filter="demo1"  class="layui-btn layui-btn-normal">提交数据</button>
                        </div>
                    </div>
                    
                    </form>
            </div>
        </div>


<div th:include="views/admin/adminfooter :: foot"></div> 
<script type="text/javascript">

    // layui方法
    layui.use(['table', 'form', 'layer'], function () {
        // 操作对象
        var form = layui.form
                , table = layui.table
                , layer = layui.layer
                , $ = layui.jquery;

        // 表格渲染//
      var tableIns=  table.render({
            elem: '#dateTable'                  //指定原始表格元素选择器（推荐id选择器）
            , height: 500    //容器高度
            , cols: [[                  //标题栏
                {checkbox: false, sort: true, fixed: true, space: true}
                , {field: 'id', title: 'ID', width: 80}
                ,{field: 'text', title: '名称', width: 130}
                , {field: 'status', title: '状态', width: 120}
                , {field: 'description', title: '描述', width: 100}
                , {fixed: 'right', title: '操作', width: 280, align: 'center', toolbar: '#barOption'} //这里的toolbar值是模板元素的选择器
            ]]
            , id: 'dataCheck'
            , url: '/getmenusslist'
            , method: 'get'
            , page: true
            , limits: [2, 4, 10, 20, 30]
            , limit: 5 //默认采用3
            , loading: false
            , done: function (res, curr, count) {
                //如果是异步请求数据方式，res即为你接口返回的信息。
                //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
                console.log(res);

                //得到当前页码
                console.log(curr);

                //得到数据总量
                console.log(count);
            }
        });
      $('#btn-refresh').on('click', function () {
     	 tableIns.reload({
          	url:'/getmenusslist',
          	done: function(res,curr,count){
             	this.where={};
             }
          });
     });
        // add
        $('#btn-add').on('click', function () {
        	 window.open('add_menus.html','_blank');
        });
        
        
        // 图表
        $('#btn-pic').on('click', function () {
        	 window.open('${pageContext.request.contextPath}/demo/map.html','_blank');
        });
        $('#btn-apply-date').on('click', function () {
        	 //按条件查询刷新table
            tableIns.reload({
            	url:'/getmenusslist',
                where: {
                	app_uploadtime: "desc"
                },done: function(res,curr,count){
                	this.where={};
                }
            });
       });
      //监听工具条
		table.on('tool(test)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性"对应的值"
		  var data = obj.data; //获得当前行数据
		  var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
		  var tr = obj.tr; //获得当前行 tr 的DOM对象
		 
		  if(layEvent === 'detail'){ //查看
		    //do somehing
		  } else if(layEvent === 'del'){ //删除
			  layer.confirm('真的删除行么', function(index){
                  console.log(data);
                  $.ajax({
                      url: "/menus_delete",
                      type: "POST",
                      data:{"id":data.id},
                      dataType: "json",
                      success: function(data){

                          if(data.state==1){
                              obj.del();
                              layer.close(index);
                              layer.msg("删除成功", {icon: 6});
                          }else{
                              layer.msg("删除失败", {icon: 5});
                          }
                      }

                  });  
              });
		  } else if(layEvent === 'edit'){ //编辑
			  window.open('/menus_update?id='+data.id,'_blank');
		  }else if(layEvent === 'edit_child'){ //编辑
			  window.open('/child_list.html?menuid='+data.id,'_blank');
		  }else if(layEvent === 'updatepremission'){ //updatepremission 
			  window.open('${pageContext.request.contextPath}/AppServlet?path=getAppPremission&id='+data.id,'_blank');
		  }else if(layEvent === 'add'){ //add子菜单
		  		var menuid =data.id;
		  		$("#menuid").val(menuid);
		  		 /* 再弹出添加界面 */
                    layer.open({
                        type:1,
                        title:"添加子菜单",
                        skin:"myclass",
                        area:["50%"],
                        content:$("#test").html()
                    });
				
                    /* 渲染表单 */
                    form.render();
		  }
		  
		  
		});
			//查询按钮点击事件
			$('.demoTable .layui-btn').on('click', function(){
	            var type = $(this).data('type');
	            var id = $('#apply_id');
                var name = $('#pname');
                 var types = $('#types');
                //按条件查询刷新table
                tableIns.reload({
                	url:'/getmenusslist',
                    where: {
                    	id:id.val(),
                    	text: name.val(),
                    	type: types.val()
                    },done: function(res,curr,count){
                    	this.where={};
                    }
                });
                
	        });
        // you code ...

    });
</script>
<!-- 表格操作按钮集  -->
<script type="text/javascript">

</script>
<script type="text/html" id="barOption">
  <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="add">添加子菜单</a>
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
  <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit_child">修改子菜单</a>
</script>


<script>
 layui.use([ 'form', 'layer'], function () {
  // 操作对象
       		 var form = layui.form
                , layer = layui.layer
                , $ = layui.jquery;
  form.render(); //更新全部
  	form.on('submit(demo1)', function(data){
        	console.log(JSON.stringify(data.field));
        	$.ajax({ 
			    type:'post',  
			    url:'/addchildMenu', 
			    cache: false,
			    data:JSON.stringify(data.field),  
			    dataType : 'json',
		    	 contentType: "application/json; charset=utf-8",
			    success:function(data){
			    	if(data.state==1){
			    		 alert('add success');
			    		 layer.close(layer.index); //它获取的始终是最新弹出的某个层，值是由layer内部动态递增计算的
			    		 /* setTimeout(function(){ window.open("adminlist.html","_self"); }, 1000); */ 
			    	}else{
			    		 alert('add error，Please check if the input is correct');
			    	}
			    },
			    error:function(){ 
			     alert("add error，Please check if the input is correct ")
			    }
	   		})
	   		return false;
        });
  
});
</script>
</body>
</html>