<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>留言管理</title>
    <link rel="stylesheet" href="/static/frame/layui/css/layui.css">
    <link rel="stylesheet" href="/static/frame/static/css/style.css">
    <link rel="icon" href="/static/frame/static/image/code.png">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<script type="text/javascript" src="/static/frame/layui/layui.js"></script>
<script type="text/javascript" src="/static/js/index.js"></script>
<body class="body">

<div th:include="views/admin/adminheads :: copy"></div> 

<hr class="layui-bg-gray">
<hr class="layui-bg-gray">

<!-- 工具集 -->
<div class="my-btn-box">
    <span class="fl">
  <!--  <a class="layui-btn btn-add btn-default" id="btn-add">添加</a> -->
   <a class="layui-btn btn-add btn-default" id="btn-check">审核通过</a>
   <!-- <a class="layui-btn btn-add btn-default" id="btn-pic">图表分析</a> -->
        <a class="layui-btn btn-add btn-default" id="btn-refresh"><i class="layui-icon">&#x1002;</i></a>
    </span><nbsp/><nbsp/>
    
   <div class="demoTable" style="padding-left:130px;">
    	id
    <div class="layui-inline">
        <input class="layui-input" name="apply_id" id="apply_id" autocomplete="off" placeholder="请输入appid" >
    </div>
    name
    <div class="layui-inline">
        <input class="layui-input" name="pname" id="pname" autocomplete="off" placeholder="请输入appname">
    </div>
    <button class="layui-btn" data-type="reload">搜索</button>
</div>
</div>

<!-- 表格 -->
<div id="dateTable"  lay-filter="test"></div>

<div th:include="views/admin/adminfooter :: foot"></div> 
<script type="text/javascript">

    // layui方法
    layui.use(['table', 'form', 'layer'], function () {
        // 操作对象
        var form = layui.form
                , table = layui.table
                , layer = layui.layer
                , $ = layui.jquery;

        // 表格渲染//
      var tableIns=  table.render({
            elem: '#dateTable'                  //指定原始表格元素选择器（推荐id选择器）
            , height: 500    //容器高度
            , cols: [[                  //标题栏 id, createdate, descirption, uid, status, appid, title, username
                {type: 'checkbox', fixed: 'left', sort: false}
                  , {field: 'id', title: 'ID', width: 80}
                ,{field: 'title', title: '名称', width: 100}
                , {field: 'status', title: '状态', width: 120}
                , {field: 'createdate', title: 'date', width: 100}
                , {field: 'descirption', title: '描述', width: 180}
                , {field: 'username', title: 'username', width: 180}
                , {fixed: 'right', title: '操作', width: 220, align: 'center', toolbar: '#barOption'} //这里的toolbar值是模板元素的选择器
            ]]
            , id: 'dataCheck'
            , url: '/getcommentslist'
            , method: 'get'
            , page: true
            , limits: [2, 4, 10, 20, 30]
            , limit: 5 //默认采用3
            , loading: false
            , done: function (res, curr, count) {
                //如果是异步请求数据方式，res即为你接口返回的信息。
                //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
                console.log(res);

                //得到当前页码
                console.log(curr);

                //得到数据总量
                console.log(count);
            }
        });
      $('#btn-refresh').on('click', function () {
     	 tableIns.reload({
          	url:'/getcommentslist',
          	done: function(res,curr,count){
             	this.where={};
             }
          });
     });
     
     table.on('checkbox(test)', function(obj){
		  console.log(obj.checked); //当前是否选中状态
		  console.log(obj.data); //选中行的相关数据
		  console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
		});
     $('#btn-check').on('click', function () {
    	 var checkStatus = table.checkStatus('dataCheck'); //idTest 即为基础参数 id 对应的值
 
		console.log(checkStatus.data) //获取选中行的数据
		console.log(checkStatus.data.length) //获取选中行数量，可作为是否有选中行的条件
		console.log(checkStatus.isAll ) //表格是否全选
		
		if(checkStatus.data.length==0){
		parent.layer.msg('请先选择要删除的数据行！', {icon: 2});
		return ;
		}
		var ids = "";
		for(var i=0;i<checkStatus.data.length;i++){
			if(i==checkStatus.data.length-1){
			ids += checkStatus.data[i].id;
			}else{
			ids += checkStatus.data[i].id+",";
			}
			
		}
		parent.layer.msg('update中...', {icon: 16,shade: 0.3,time:5000});
		$.post('/updatecomment_status',
	            {'ids':ids},
	            function(data){
			        layer.closeAll('loading');
			        if(data.state==1){
				        parent.layer.msg('update成功！', {icon: 1,time:3000,shade:0.2});
				        location.reload(true);
			        }else{
				        parent.layer.msg('update失败！', {icon: 2,time:2000,shade:0.2});
			        }
		        }
	    );

		
		
     });
     
        // add
        $('#btn-add').on('click', function () {
        	  window.open('add_ins.html','_blank');
        });
        // 图表
        $('#btn-pic').on('click', function () {
        	 window.open('${pageContext.request.contextPath}/demo/map.html','_blank');
        });
        $('#btn-apply-date').on('click', function () {
        	 //按条件查询刷新table
            tableIns.reload({
            	url:'/getcommentslist',
                where: {
                	app_uploadtime: "desc"
                },done: function(res,curr,count){
                	this.where={};
                }
            });
       });
      //监听工具条
		table.on('tool(test)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性"对应的值"
		  var data = obj.data; //获得当前行数据
		  var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
		  var tr = obj.tr; //获得当前行 tr 的DOM对象
		 
		  if(layEvent === 'detail'){ //查看
		    //do somehing
		  } else if(layEvent === 'del'){ //删除
			  layer.confirm('真的删除行么', function(index){
                  console.log(data);
                  $.ajax({
                      url: "/comment_delete",
                      type: "POST",
                      data:{"id":data.id},
                      dataType: "json",
                      success: function(data){

                          if(data.state==1){
                              obj.del();
                              layer.close(index);
                              layer.msg("删除成功", {icon: 6});
                          }else{
                              layer.msg("删除失败", {icon: 5});
                          }
                      }

                  });  
              });
		  } else if(layEvent === 'edit'){ //编辑
			  window.open('/comment_update?id='+data.id,'_blank');
		  }else if(layEvent === 'begin'){ //updatepremission 
					  layer.confirm('真的开班么?', function(index){
			                  console.log(data);
			                    //同步更新缓存对应的值
			                  $.ajax({
			                      url: "/beginclass",
			                      type: "POST",
			                      data:{"id":data.id},
			                      dataType: "json",
			                      success: function(data){
			                      if(data.state=="sucess"){
					                         obj.update({
										      status: '已开班'
										    });
			                              layer.msg("已开班成功", {icon: 6});
			                          }else{
			                              layer.msg("已开班失败", {icon: 5});
			                          }
			                      }
			
			                  });  
					});
			  }
		});
			//查询按钮点击事件
			$('.demoTable .layui-btn').on('click', function(){
	            var type = $(this).data('type');
	            var id = $('#apply_id');
                var name = $('#pname');
                 var types = $('#types');
                //按条件查询刷新table
                tableIns.reload({
                	url:'/getcommentslist',
                    where: {
                    	id:id.val(),
                    	title: name.val(),
                    	type: types.val()
                    },done: function(res,curr,count){
                    	this.where={};
                    },page: {
			              curr: 1 //重新从第 1 页开始
			            }
                });
                
	        });
        // you code ...

    });
</script>
<!-- 表格操作按钮集 -->
<script type="text/javascript">
/* 时间戳转化开始 */
</script>
<script type="text/html" id="barOption">
<a class="layui-btn layui-btn-mini layui-btn-danger" lay-event="del">删除</a>

</script>

</body>
</html>